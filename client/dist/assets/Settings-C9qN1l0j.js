import{a as S,r as a,j as e,u as v}from"./index-BwmDE6J8.js";import{u as g,a as E,b as w,U as k,N as M,F as A,D as H}from"./Footer-Dm3DVUD_.js";var I=S();const O=n=>{const[t,s]=a.useState(!1),r=a.useCallback(u=>n.current?s(n.current&&!n.current.contains(u.target)):s(!1),[n]),i=a.useCallback(()=>(document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)),[r]);return a.useEffect(()=>{i()},[i]),t},C=a.createContext(),o=({isOpen:n,onClose:t,onConfirm:s,children:r,...i})=>{const u=a.useRef(),h=O(u),x=a.useCallback(c=>{if(c.keyCode===27&&(c.preventDefault(),t()),c.keyCode===9){if(!u||!u.current)return;c.preventDefault();const f=Array.from(u.current.querySelectorAll('button[type="button"]'));if(!f.length)return;let b=f.findIndex(j=>j===document.activeElement)+1;b>f.length-1&&(b=0),f[b].focus({focusVisible:!0})}},[t]),m=a.useCallback(()=>(document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)),[x]);return a.useEffect(()=>{m()},[m]),a.useEffect(()=>{h&&t()},[h,t]),I.createPortal(e.jsx(e.Fragment,{children:n&&e.jsx("div",{className:"dialog-overlay",...i,children:e.jsx("div",{className:"dialog-container bg-primary",ref:u,children:e.jsx(C.Provider,{value:{onClose:t,onConfirm:s},children:r})})})}),document.body)};o.Header=function({children:t,className:s,...r}){return e.jsx("div",{className:`modal-header d-flex justify-content-between align-middle ${s}`,...r,children:t})};o.Header.Title=function({children:t,className:s,...r}){return e.jsx("h3",{className:`modal-title ${s}`,...r,children:t})};o.Header.CloseButton=function({children:t,className:s,...r}){const{onClose:i}=a.useContext(C);return e.jsx("button",{type:"button",className:`btn-close ${s}`,style:{marginTop:"-1.5rem"},onClick:i,...r,children:e.jsx("span",{"aria-hidden":"true",children:t})})};o.Body=function({children:t,className:s,...r}){return e.jsx("div",{className:`modal-body ${s}`,...r,children:t})};o.Footer=function({children:t,className:s,...r}){return e.jsx("div",{className:`modal-footer gap-3 ${s}`,...r,children:t})};o.Footer.ConfirmButton=function({children:t,className:s,...r}){const{onConfirm:i}=a.useContext(C);return e.jsx("button",{className:`btn btn-primary ${s}`,onClick:i,type:"button",...r,children:t})};o.Footer.CancelButton=function({children:t,className:s,...r}){const{onClose:i}=a.useContext(C);return e.jsx("button",{className:`btn btn-secondary ${s}`,type:"button",onClick:i,...r,children:t})};const T=({showUpdateUserConfirmModal:n,setShowUpdateUserConfirmModal:t,handleUpdateUser:s})=>e.jsxs(o,{isOpen:n,onClose:()=>t(!1),onConfirm:s,children:[e.jsxs(o.Header,{children:[e.jsx(o.Header.Title,{children:e.jsx("p",{className:"text-warning",children:"Caution!"})}),e.jsx(o.Header.CloseButton,{})]}),e.jsx(o.Body,{children:e.jsx("p",{className:"ml-5 mb-4",children:"Your account will be updated. You'll have to login again. Wish to continue?"})}),e.jsxs(o.Footer,{className:"d-flex justify-center",children:[e.jsx(o.Footer.ConfirmButton,{className:"btn btn-warning",children:"Update Account"}),e.jsx(o.Footer.CancelButton,{children:"Cancel"})]})]}),$=()=>{const[n,t]=a.useState(""),[s,r]=a.useState(""),[i,u]=a.useState(""),[h,x]=a.useState({}),[m,c]=a.useState(null),[f,d]=a.useState(!1),[b,j]=a.useState(!1),U=v(),N=g(l=>l.authUser),F=g(l=>l.unsetAuthUser),[B,{loading:y}]=E(k,{variables:{updateUserInputs:{}},onCompleted:l=>{if(l.UpdateUser&&U)return F(),U("/login",{replace:!0})},onError:l=>{if(l){const p=l.toString().split(":").pop();c(p)}},update:l=>{l.writeQuery({query:w,data:{FetchActiveUser:null}})}});a.useEffect(()=>{d(y||m!==null)},[y,m]);const D=async l=>{l.preventDefault();const p={};if(s&&s.trim()&&(p.email=s.trim()),n&&n.trim()&&(p.username=n.trim()),i&&i.trim()&&(p.password=i.trim()),!Object.keys(p).length)return c("Enter any one value to update user!");if(p.email===N.email)return c("New email should be different than existing one");if(p.username===N.username)return c("New username should be different than existing one");x(p),j(!0)};return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-center",children:"Update Account"}),m&&e.jsxs("div",{className:"alert alert-dismissible alert-danger mt-5",children:[e.jsx("button",{type:"button",className:"btn-close",onClick:()=>c(null)}),m]}),e.jsxs("form",{noValidate:!0,autoComplete:"off",onSubmit:D,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"usernameOrEmail",className:"form-label mt-4",children:"New Username"}),e.jsx("input",{type:"email",className:"form-control",id:"username",placeholder:"New username",onChange:l=>t(l.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"usernameOrEmail",className:"form-label mt-4",children:"New Email"}),e.jsx("input",{type:"email",className:"form-control",id:"email",placeholder:"New email",onChange:l=>r(l.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"usernameOrEmail",className:"form-label mt-4",children:"New Password"}),e.jsx("input",{type:"password",className:"form-control",id:"password",placeholder:"New password",onChange:l=>u(l.target.value)})]}),e.jsx("div",{className:"d-grid gap-2 mt-5",children:e.jsx("button",{className:`btn btn-lg btn-outline-warning border-warning ${f??"disabled"}`,type:"submit",disabled:f,children:"Update account"})})]}),e.jsx(T,{showUpdateUserConfirmModal:b,setShowUpdateUserConfirmModal:j,handleUpdateUser:()=>{B({variables:{updateUserInputs:{...h}}})}})]})},P=({showDeleteUserConfirmModal:n,setShowDeleteUserConfirmModal:t,handleDeleteUser:s})=>e.jsxs(o,{isOpen:n,onClose:()=>t(!1),onConfirm:s,children:[e.jsxs(o.Header,{children:[e.jsx(o.Header.Title,{children:e.jsx("p",{className:"text-danger",children:"Caution!"})}),e.jsx(o.Header.CloseButton,{})]}),e.jsx(o.Body,{children:e.jsx("p",{className:"ml-5 mb-4",children:"This action is irreversible. Your account and all your data will be permanently deleted. Wish to continue?"})}),e.jsxs(o.Footer,{className:"d-flex justify-center",children:[e.jsx(o.Footer.ConfirmButton,{className:"btn btn-danger",children:"Delete Account"}),e.jsx(o.Footer.CancelButton,{children:"Cancel"})]})]}),q=()=>{const[n,t]=a.useState(null),[s,r]=a.useState(!1),[i,u]=a.useState(!1),h=v(),x=g(d=>d.unsetAuthUser),[m,{loading:c}]=E(H,{onCompleted:d=>{if(d.DeleteUser&&h)return x(),h("/login",{replace:!0})},onError:d=>{if(d){const b=d.toString().split(":").pop();t(b)}},update:d=>{d.writeQuery({query:w,data:{FetchActiveUser:null}})}});a.useEffect(()=>{r(c||n!==null)},[c,n]);const f=()=>{m()};return e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx("div",{className:"container",children:e.jsxs("div",{className:"container mt-5 col-12 col-md-8 col-lg-4",children:[n&&e.jsxs("div",{className:"alert alert-dismissible alert-danger mt-5",children:[e.jsx("button",{type:"button",className:"btn-close",onClick:()=>t(null)}),n]}),e.jsx($,{}),e.jsx("div",{className:"d-grid my-3",children:e.jsx("button",{type:"button",className:`btn btn-lg btn-outline-danger border-danger ${s&&"disabled"}`,onClick:()=>u(!0),disabled:s,children:"Delete account"})})]})}),e.jsx(A,{}),e.jsx(P,{showDeleteUserConfirmModal:i,setShowDeleteUserConfirmModal:u,handleDeleteUser:f})]})};export{q as default};
